%p
  We provide a way to add bikes via JSON posts to our API.

%p
  Here are the things that need to be sent in the request:

/ %article.code
/   %p.code-label
/     POST request and possible parameters
/   - request_url = api_v1_bikes_url
/   %pre
/     :plain
/       $.ajax({
/         type: "POST",
/         url: "#{request_url}",
/         data: {
/           organization_slug: organization_slug,
/           access_token: org_access_token,
/           bike: bike_hash,
/           stolen_record: stolen_record_hash, // optional
/           components: components_hash        // optional
/         },
/       });


%article.code
  %table.table
    %tbody
      %tr
        %td
          %code
            organization_slug
        %td
          string
        %td
          The slug for the organization registering the bike.
      %tr
        %td
          %code
            access_token
        %td
          string
        %td
          The access token for the organization registering the bike.
      %tr
        %td
          %code
            bike
        %td
          hash
        %td
          An object containing key value pairs of the bike's attributes
      %tr
        %td
          %code
            stolen_record
        %td
          hash
        %td
          Optional. An object with information about the bike theft.
      %tr
        %td
          %code
            components
        %td
          array
        %td
          Optional. An array of hashes with attributes for the bike's components.

          
      
%h3#org_access
  Organization and access tokens

%p
  You have to submit an organization and an access token to post bikes to the Index.

%p
  We provide a test organization to add bikes via our API, so you can get started and figure out how to add bikes without having an organization access token.

- org = Organization.find_by_name('Example organization')


%dl.dl-horizontal.dl-wider-dt
  %dt#example_organization{ data: {slug: org.slug, token: org.access_token}}
    Test organization slug
  %dd
    = org.slug
  %dt
    Access token
  %dd
    = org.access_token

%article
  .alert.alert
    Test bikes behave like normal bikes on the Index in most ways. You can view them and you can edit them if the owner_email is the email you are logged in with. There are some important differences though:
    %ul.key-differences
      %li
        No email is sent when they are created
      %li
        Are not visible in searches
      %li
        They're deleted every day or so.

%h3#bike_hash
  Bike object (hash)

%p
  The following keys are required for a valid
  %code
    bike

%article.code
  %table.table
    %tbody
      %tr
        %td
          %code
            serial_number
        %td
          string
        %td
          The bike's serial. Set to "absent" if the bike doesn't have a serial number.
      %tr
        %td
          %code
            manufacturer
        %td
          string
        %td
          The name of the frame manufacturer
      %tr
        %td
          %code
            color
        %td
          string
        %td
          The color of the frame
      %tr
        %td
          %code
            rear_wheel_bsd
        %td
          integer
        %td
          Rear wheel size, the tire's #{link_to "BSD", "#wheel_sizes_ref", class: "scroll-to-ref"}
      %tr
        %td
          %code
            rear_tire_narrow
        %td
          boolean
        %td
          Whether the tire width is less than 32mm
      %tr
        %td
          %code
            owner_email
        %td
          string
        %td
          email that should receive the registration

%article.code
  %p.code-label
    Basic post

  - request_url = api_v1_bikes_url
  %pre
    :plain
      $.ajax({
        type: "POST",
        url: "#{request_url}",
        data: {
          organization_slug: "#{org.slug}",
          access_token: "#{org.access_token}",
          bike: {
            serial_number: "XOXO <3",
            manufacturer: "Surly",
            color: "Blue",
            rear_wheel_bsd: 559,
            rear_tire_narrow: false,
            owner_email: "new_bike_owner@bikeindex.org"
          }
        },
        success: function(data, textStatus, jqXHR) {
          $('#bike_basic').text(JSON.stringify(data,undefined,2))
        }
      });
%article.code
  %p.code-label
    Response
  %pre#bike_basic{ data: {url: request_url }}
    - if Rails.env.production?
      :plain
        {
          "bike": {
            "web_url": "#{link_to "https://bikeindex.org/bikes/1520", "https://bikeindex.org/bikes/1520"}",
            "api_url": "#{ link_to "https://bikeindex.org/api/v1/bikes/1520", "https://bikeindex.org/api/v1/bikes/1520"}"
          }
        }
%p
  The 
  %code
    bike
  object accepts some optional additional attributes. Include them if you want!
%article.code
  %table.table
    %tbody
      %tr
        %td
          %code
            description
        %td
          text
        %td
          A description of the bike. This is searched, so it's a good idea add any distinguishing features.
      %tr
        %td
          %code
            cycle_type_slug
        %td
          string
        %td
          Can be any of the names from the list of #{link_to "cycle_types", "#cycle_types_ref", class: "scroll-to-ref"}. Defaults to "bike"
      %tr
        %td
          %code
            frame_material_slug
        %td
          string
        %td
          The type of material the frame is made from, chosen from #{link_to "frame_materials","#frame_materials_ref", class: "scroll-to-ref"}
      %tr
        %td
          %code
            handlebar_type_slug
        %td
          string
        %td
          The slug of the handlebar type, chosen from the list of #{link_to "handlebar_types", "#handlebar_types_ref", class: "scroll-to-ref"}

/ description: "Has an under-seat beer opener and a handlebar flower vase",

%h3#stolen_bikes
  Adding stolen bikes

%p
  To create a stolen bike, you have to add two keys pairs to your
  %code
    bike

%article.code
  %table.table

    %tbody
      %tr
        %td
          %code
            stolen
        %td
          boolean
        %td
          %code
            true
      %tr
        %td
          %code
            phone
        %td
          string
        %td
          Phone number of the stolen bike owner. Format doesn't matter

%p
  You can also add information about the bike theft to create a more accurate record. You put this information in the
  %code
    stolen_record
  object.

%p
  The keys available for the
  %code
    stolen_record


  / stolen_record.theft_description, stolen_record.street, stolen_record.city = [
  /   sr[:theft_description], sr[:street], sr[:city]
  / ]
  / stolen_record.phone = sr[:phone] if sr[:phone].present?
  / stolen_record.date_stolen = create_date_from_string(sr[:date_stolen]) if sr[:date_stolen].present?
  / stolen_record.country_id = Country.fuzzy_iso_find(sr[:country]).id if sr[:country].present?

%article.code
  %table.table

    %tbody
      %tr
        %td
          %code
            date_stolen
        %td
          string
        %td
          Format mm-dd-yyyy. Defaults to the current date.
      %tr
        %td
          %code
            theft_description
        %td
          text
        %td
          Description of the theft
      %tr
        %td
          %code
            country
        %td
          string
        %td
          #{link_to "Country code", "https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements"}, required if submitting location information.
      %tr
        %td
          %code
            street
        %td
          string
        %td
          Address or intersection where the theft occurred.
      %tr
        %td
          %code
            zipcode
        %td
          string
        %td
          Postal zipcode
      %tr
        %td
          %code
            state
        %td
          string
        %td
          State postal code, if in the US

      %tr
        %td
          %code
            police_report_number
        %td
          string
        %td
          Police crime report number for this theft.
      %tr
        %td
          %code
            police_report_department
        %td
          string
        %td
          Police department where the theft was reported.
%p
  Here is an example post with all the possible attributes. Remember: Only the two attributes from the
  %code
    bike
  object are required to create a stolen bike record, the rest is icing on the cupcake.

%article.code
  %p.code-label
    Stolen Bike

  - request_url = api_v1_bikes_url
  %pre
    :plain
      $.ajax({
        type: "POST",
        url: "#{request_url}",
        data: {
          organization_slug: "#{org.slug}",
          access_token: "#{org.access_token}",
          bike: {
            stolen: true,
            phone: "(124) 534-6339",
            serial_number: "XXXX :(",
            manufacturer: "Jamis",
            color: "Black",
            rear_wheel_bsd: 559,
            rear_tire_narrow: false,
            owner_email: "stolen_bike_owner@bikeindex.org"
          },
          stolen_record: {
            date_stolen: "03-01-2013",
            theft_description: "This bike was stolen and that's no fair.",
            country: "US",
            street: "Cortland and Ashland",
            city: "Chicago",
            zipcode: "60622",
            state: "IL",
            police_report_number: "99999999",
            police_report_department: "Chicago"
          },
        },
        success: function(data, textStatus, jqXHR) {
          $('#bike_stolen').text(JSON.stringify(data,undefined,2))
        }
      });
%article.code
  %p.code-label
    Response
  %pre#bike_stolen{ data: {url: request_url }}
    - if Rails.env.production?
      :plain
        {
          "bike": {
            "web_url": "#{link_to "https://bikeindex.org/bikes/1532", "https://bikeindex.org/bikes/1532"}",
            "api_url": "#{ link_to "https://bikeindex.org/api/v1/bikes/1532", "https://bikeindex.org/api/v1/bikes/1532"}"
          }
        }


%h3#bike_components
  Adding components to bikes

%p
  \... soon to be