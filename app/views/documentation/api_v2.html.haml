!!!
%html
  %head
    %title
      Bike Index API documentation
    <link rel="shortcut icon" href="/fav.ico" />
    = stylesheet_link_tag "documentation_v2", media: "all"
    = stylesheet_link_tag "application", media: "all"
    <script type="text/javascript">window.base_url = "#{ENV['BASE_URL']}";</script>
    = stylesheet_link_tag "updated", media: "all"
    <link href='http://fonts.googleapis.com/css?family=Anonymous+Pro:400,400italic,700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    %script{src: "/swagger/shred.bundle.js", type: "text/javascript"}
    %script{src: "/swagger/jquery-1.8.0.min.js", type: "text/javascript"}
    %script{src: "/swagger/jquery.slideto.min.js", type: "text/javascript"}
    %script{src: "/swagger/jquery.wiggle.min.js", type: "text/javascript"}
    %script{src: "/swagger/jquery.ba-bbq.min.js", type: "text/javascript"}
    %script{src: "/swagger/handlebars-1.0.0.js", type: "text/javascript"}
    %script{src: "/swagger/underscore-min.js", type: "text/javascript"}
    %script{src: "/swagger/backbone-min.js", type: "text/javascript"}
    %script{src: "/swagger/swagger.js", type: "text/javascript"}
    %script{src: "/swagger/swagger-client.js", type: "text/javascript"}
    %script{src: "/swagger/swagger-ui.js", type: "text/javascript"}
    %script{src: "/swagger/highlight.7.3.pack.js", type: "text/javascript"}
    / enabling this will enable oauth2 implicit scope support
    %script{src: "/swagger/swagger-oauth.js", type: "text/javascript"}
    = javascript_include_tag "documentation_v2"
    
  %body.swagger-section
    %header#header.content-header
      .container.bikes-nav
        .small-header
          %a.top-logo{ href: root_url }
            %span.stripey
            = image_tag "/assets/updated/home/logo.svg", class: 'logo'
        %form#api_selector.form
          .api-header-group.api-header-url
            %label{ for: 'baseUrl' }
              Swagger doc url
            %input#input_baseUrl.form-control{:name => "baseUrl", :placeholder => "https://bikeindex.org/api/v2", :type => "text"}
          .api-header-group.api-header-key
            %label{ for: 'baseUrl' }
              API key
            %input#input_apiKey.form-control{:name => "apiKey", :placeholder => "api_key", :type => "text"}
          %a#explore.btn.binxbtn{:href => "#"}
            Explore
    .container
      .api-info-header
        %h1.padded
          Bike Index API V2
        .alert
          %p
            %strong
              API V2 is under construction!
            The "/user/current" route is locked in and won't change - but otherwise no guarantees for the next few weeks as we finish building this out. If you've got suggestions or requirements for this API, please contact #{link_to "support@bikeindex.org", "mailto:support@bikeindex.org"}. (12/5/2014)
          %p.padded
            %strong
              Upcoming features:
          %ul
            %li
              Bike creation
            %li
              Bike editing/updating
            %li
              Contacting stolen bike owners
            %li
              User editing/updating
            %li
              Refresh token documentation
            %li
              Client-side flow documentation

        %h2.padded
          Authentication notes
        .alert.alert-info
          The Bike Index uses OAuth2. Every time you are updating information or accessing user information, you need to pass an access token.
        %p
          There are two supported ways of authenticating with the Bike Index through OAuth2:
        %ol
          %li
            <strong>Authorization flow</strong>, also called Explicit grant flow. If you create a token on this page, this what the token is created with.

          %li
            <strong>Client-side flow</strong>, also called Implicit grant flow or Bearer flow.
        %p.padded
          The Authorization flow enables long lived access through refresh tokens (instead of logging out the user every hour), is more secure, and is generally what you should be using. Learn more about #{link_to "Authorization flow in OAuth2", "http://labs.hybris.com/2012/06/01/oauth2-authorization-code-flow/", target: '_blank'}.

        %p
          The Client-side flow is good for client-side javascript apps. Here's an article on #{link_to "Client-side flow in OAuth2", "http://labs.hybris.com/2012/06/05/oauth2-the-implicit-flow-aka-as-the-client-side-flow/", target: '_blank'}.
        %p
          To review the applications you've authorized, go to #{link_to "/oauth/authorized_applications", "#{ENV['BASE_URL']}/oauth/authorized_applications"}.

        / %h3.padded
        /   Sending us your access tokens in requests
        / %p
        /   By default we authenticate you with HTTP Basic authentication scheme. If the basic auth is not found in the authorization header, then it falls back to post parameters (all authenticated requests in the docuentation below put the access token in the parameters).
        %h3.padded
          Refresh tokens
        %p
          Since tokens provide access to someone's account, one of the ways OAuth2 keeps things secure is by having tokens expire - so if someone compromises an access token, they don't have unlimited access to an account. The Bike Index expires tokens after 1 hour.
        %p
          When your access token expires, you can get a new one by making a POST request with your app id and the refresh token:
        %pre
          POST #{ENV['BASE_URL']}/oauth/token?grant_type=refresh_token&client_id={app_id}&refresh_token={refresh_token}
        %p
          %strong
            We'll add this to the applications section via a button for requesting a refresh token soon!


    .applications-panel
      .container
        .api-info-header
          %h2
            Applications:
            %span.pull-right.less-strong
              = link_to "Add an application", "/oauth/applications"

          = render 'api_v2_applications'
    .container
      %h2.padded
        General notes:
      %p
        %strong
          Time
        Bike Index API V2 display everything in #{link_to "UTC unix timestamps", "https://en.wikipedia.org/wiki/Unix_time", target: '_blank'} (integers). Any time parameters you send need to use timestamps as well.
      / %p
      /   %strong
      /     Booleans
      /   Sometimes there are booleans. They should be sent as 0 (false) or 1 (true).
      %p
        %strong
          Bike
        We use the work "bike" throughout this documentation to mean anything that is registered (be it a tandem, ice-cream cart or standard bicycle). If we are referring specifically to standard bicycles, we will make note of that.
      %h2.padded
        Bike Index API V2 endpoints

    #message-bar.swagger-ui-wrap &nbsp;

    #swagger-ui-container.swagger-ui-wrap
    .container
      .api-info-footer       
        / .authentication-notes
        /   #{render 'authentication_info'}

        .alert.alert-info.margined
          %p
            %strong
              About this documentation:
            this documentation is generated by #{link_to "Swagger.io", "https://github.com/swagger-api/swagger-ui", target: '_blank'}. To learn more about Swagger and why it's awesome check out #{link_to "Swagger.io", "http://swagger.io/", target: '_blank'}.

    = render 'shared/footer_updated'