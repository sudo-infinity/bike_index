!!!
%html
  %head
    %title
      Bike Index API documentation
    <link rel="shortcut icon" href="/fav.ico" />
    = stylesheet_link_tag "documentation_v2", media: "all"
    = stylesheet_link_tag "application", media: "all"
    <script type="text/javascript">window.base_url = "#{ENV['BASE_URL']}";</script>
    = stylesheet_link_tag "updated", media: "all"
    <link href='http://fonts.googleapis.com/css?family=Anonymous+Pro:400,400italic,700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    %script{src: "/swagger/shred.bundle.js", type: "text/javascript"}
    %script{src: "/swagger/jquery-1.8.0.min.js", type: "text/javascript"}
    %script{src: "/swagger/jquery.slideto.min.js", type: "text/javascript"}
    %script{src: "/swagger/jquery.wiggle.min.js", type: "text/javascript"}
    %script{src: "/swagger/jquery.ba-bbq.min.js", type: "text/javascript"}
    %script{src: "/swagger/handlebars-1.0.0.js", type: "text/javascript"}
    %script{src: "/swagger/underscore-min.js", type: "text/javascript"}
    %script{src: "/swagger/backbone-min.js", type: "text/javascript"}
    %script{src: "/swagger/swagger.js", type: "text/javascript"}
    %script{src: "/swagger/swagger-client.js", type: "text/javascript"}
    %script{src: "/swagger/swagger-ui.js", type: "text/javascript"}
    %script{src: "/swagger/highlight.7.3.pack.js", type: "text/javascript"}
    / enabling this will enable oauth2 implicit scope support
    %script{src: "/swagger/swagger-oauth.js", type: "text/javascript"}
    = javascript_include_tag "documentation_v2"
    
  %body.swagger-section
    %header#header.content-header
      .container.bikes-nav
        .small-header
          %a.top-logo{ href: root_url }
            %span.stripey
            = image_tag "/assets/updated/home/logo.svg", class: 'logo'
        %form#api_selector.form
          .api-header-group.api-header-url
            %label{ for: 'baseUrl' }
              Swagger doc url
            %input#input_baseUrl.form-control{:name => "baseUrl", :placeholder => "https://bikeindex.org/api/v2", :type => "text"}
          .api-header-group.api-header-key
            %label{ for: 'baseUrl' }
              API key
            %input#input_apiKey.form-control{:name => "apiKey", :placeholder => "api_key", :type => "text"}
          %a#explore.btn.binxbtn{:href => "#"}
            Explore
    .container
      .api-info-header
        %h1.padded
          Bike Index API V2
        .alert.alert-danger
          %p
            %strong
              API V2 is under construction!
            The "/user/current" route is locked in and won't change - but otherwise no guarantees for the next few weeks as we finish building this out. If you've got suggestions or requirements for this API, please contact #{link_to "support@bikeindex.org", "mailto:support@bikeindex.org"}. (12/5/2014)
        
        %h2
          Applications
        - if @applications.present?
          %ul
            - @applications.each do |application|
              %li
                .well
                  %h3
                    %strong
                      Application name:
                    = application.name
                  - tokens = application.access_tokens.where(resource_owner_id: current_user.id).select{ |t| t.expired? != true }
                  - if tokens.present?
                    %h4
                      Your access tokens:
                    %ul.access-tokens
                      - tokens.each do |token|
                        - next if token.expired?
                        %li
                          Access token: 
                          %code
                            = token.token
                          Scopes
                          %code
                            = token.scopes
                  - else
                    %h4 no tokens
          - else
            %p
              You don't have any applications set up! To be able to use the API you will need to create an application and generate an access token.
            %p
              #{link_to "Add an application here", "/oauth/applications"}.

    #message-bar.swagger-ui-wrap &nbsp;

    #swagger-ui-container.swagger-ui-wrap
    .container
      .api-info-footer       
        .authentication-notes
          #{render 'authentication_info'}

        .alert.alert-info.margined
          %p
            %strong
              About this documentation:
            this documentation is generated by #{link_to "Swagger.io", "https://github.com/swagger-api/swagger-ui"}, from our Swagger-compliant API. To learn more about Swagger and why it's awesome check out #{link_to "Swagger.io", "http://swagger.io/"} .

    = render 'shared/footer_updated'