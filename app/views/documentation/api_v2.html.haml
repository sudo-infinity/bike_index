!!!
%html
  %head
    %title
      Bike Index API documentation
    <link rel="shortcut icon" href="/fav.ico" />
    = stylesheet_link_tag "documentation_v2", media: "all"
    = stylesheet_link_tag "application", media: "all"
    <script type="text/javascript">window.base_url = "#{ENV['BASE_URL']}";</script>
    = stylesheet_link_tag "updated", media: "all"
    <link href='http://fonts.googleapis.com/css?family=Anonymous+Pro:400,400italic,700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    = javascript_include_tag "documentation_v2"
    
  %body.swagger-section
    %header#header
      .content-header
        .container-fluid.bikes-nav
          .small-header
            %a.top-logo{ href: root_url }
              %span.stripey
              = image_tag "/assets/updated/home/logo.svg", class: 'logo'
          %form#api_selector.form
            .api-header-group.api-header-url
              / %label{ for: 'baseUrl' }
              /   Swagger doc url
              / %input#input_baseUrl.form-control{:name => "baseUrl", :placeholder => "https://bikeindex.org/api/v2", :type => "text"}
            .api-header-group.api-header-key
              %label{ for: 'baseUrl' }
                Access token
              %input#input_apiKey.form-control{:name => "apiKey", :placeholder => "api_key", :type => "text"}
            %a#explore.btn.binxbtn{:href => "#"}
              Explore
    .container-fluid
      .api-info-header

        / .alert
        /   %p
        /     %strong
        /       This API is in beta.
        /     contact #{link_to "seth@bikeindex.org", "mailto:seth@bikeindex.org"} with questions or for updates.
        /   %p.padded
        /     %strong
        /       Upcoming features:
        /   %ul
        /     / %li
        /     /   Updating/deleting existing components
        /     %li
        /       Marking a bike recovered
        /     %li
        /       User creation
        /     %li
        /       Uploading photos of bikes
        /   %p
        /     %strong
        /       The documentation is going to be improving significantly (live by 1/28):
        /   %ul
        /     %li
        /       Refresh token documentation
        /     %li
        /       Client-side flow documentation
        /     %li
        /       Examples of bike creation and editing
        /     %li
        /       Links to external Bike Index tools

        :plain
          #{render "documentation/api_v2/info_header"}
      
      .start-of-swagger-ui
        %h2
          Bike Index API V2 endpoints

    #message-bar.swagger-ui-wrap &nbsp;

    #swagger-ui-container.swagger-ui-wrap
  
    .applications-panel#applications_list
      .container-fluid
        .clearfix
          %h2
            Your applications:
            %span.pull-right.less-strong
              = link_to "Add an application", "/oauth/applications"
          = render 'api_v2_applications'
    .container-fluid
      .api-info-footer
        #authentication_notes
          %h2
            Authentication details and description
          
          %p
            There are two supported ways of authenticating with the Bike Index through OAuth2:
          %ol
            %li
              <strong>Authorization flow</strong>, also called Explicit grant flow. If you create a token on this page, this what the token is created with.

            %li
              <strong>Client-side flow</strong>, also called Implicit grant flow or Bearer flow.
          %p.padded
            The Authorization flow enables long lived access through refresh tokens (instead of logging out the user every hour), is more secure, and is generally what you should be using. Learn more about #{link_to "Authorization flow in OAuth2", "http://labs.hybris.com/2012/06/01/oauth2-authorization-code-flow/", target: '_blank'}.

          %p
            The Client-side flow is good for client-side javascript apps. Here's an article on #{link_to "Client-side flow in OAuth2", "http://labs.hybris.com/2012/06/05/oauth2-the-implicit-flow-aka-as-the-client-side-flow/", target: '_blank'}.
          %p
            To review the applications you've authorized, go to #{link_to "/oauth/authorized_applications", "#{ENV['BASE_URL']}/oauth/authorized_applications"}.

          / %h3.padded
          /   Sending us your access tokens in requests
          / %p
          /   By default we authenticate you with HTTP Basic authentication scheme. If the basic auth is not found in the authorization header, then it falls back to post parameters (all authenticated requests in the docuentation below put the access token in the parameters).
          %h3.padded
            Refresh tokens
          %p
            Since tokens provide access to someone's account, one of the ways OAuth2 keeps things secure is by having tokens expire - so if someone compromises an access token, they don't have unlimited access to an account. The Bike Index expires tokens after 1 hour.
          %p
            When your access token expires, you can get a new one by making a POST request with your app id and the refresh token:
          %pre
            POST #{ENV['BASE_URL']}/oauth/token?grant_type=refresh_token&client_id={app_id}&refresh_token={refresh_token}
          %p
            %strong
              We'll add this to the applications section via a button for requesting a refresh token soon!
          / .authentication-notes
          /   #{render 'authentication_info'}
    %hr
    .container-fluid
      .alert.alert-info.margined
        %p
          / %strong
          /   About this documentation:
          This documentation is generated by #{link_to "Swagger.io", "https://github.com/swagger-api/swagger-ui", target: '_blank'}. To learn more about Swagger and why it's awesome check out #{link_to "Swagger.io", "http://swagger.io/", target: '_blank'}.
        .form-group
          %label.control-label{ for: 'input_baseUrl' }
            Swagger doc url
          %input#input_baseUrl.form-control{:name => "baseUrl", :placeholder => "https://bikeindex.org/api/v2", :type => "text"}

    = render 'shared/footer_updated'